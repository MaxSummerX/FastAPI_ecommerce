from rich.console import Console
from sqlalchemy import and_, desc, func, select

from app.database import SessionLocal
from app.models.categories import Category
from app.models.products import Product


console = Console(color_system="auto", force_terminal=True)

# –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Å–µ—Å—Å–∏–π
with SessionLocal() as session:
    # 1. –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    # –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –∑–∞–ø—Ä–æ—Å –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±—ä–µ–∫—Ç Select
    stmt = select(Category).where(Category.is_active).order_by(Category.name)

    # 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞.
    result = session.execute(stmt).scalars().all()
    print(result)

# 1. –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞

# –ú–µ—Ç–æ–¥ select() - –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ SQLAlchemy. –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ (—Ç–∞–±–ª–∏—Ü—ã, –º–æ–¥–µ–ª–∏ ORM) –∏–ª–∏ —Å—Ç–æ–ª–±—Ü—ã –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–≤–ª–µ—á—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –∞–Ω–∞–ª–æ–≥ SELECT –≤ SQL

# –í—ã–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –º–æ–¥–µ–ª–∏ Category
example_1 = select(Category)
# –í—ã–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –º–æ–¥–µ–ª–∏
example_2 = select(Category.id, Category.name)


# –ú–µ—Ç–æ–¥ where() - –¥–æ–±–∞–≤–ª—è–µ—Ç —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ WHERE –≤ SQL

# –§–∏–ª—å—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
example_3 = select(Category)
# –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
example_4 = select(Category).where(and_(Category.is_active, Category.name.like("%tech%")))
# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –ø—Ä–∏–º–µ—Ä—É example_4
example_5 = select(Category).where(Category.is_active).where(Category.name.like("%text%"))


# –ú–µ—Ç–æ–¥ order_by() - –∑–∞–¥–∞–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ORDER BY –≤ SQL.

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
example_6 = select(Category).order_by(Category.name)
# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é
example_7 = select(Category).order_by(desc(Category.name))
# –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
example_8 = select(Category).order_by(Category.is_active.desc(), desc(Category.name))


# –ú–µ—Ç–æ–¥ join() - –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ JOIN –≤ SQL. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü —á–µ—Ä–µ–∑ –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏–ª–∏ —è–≤–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.

# JOIN –º–µ–∂–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ Category –∏ Product
example_9 = select(Category, Product).join(Product, Category.id == Product.category_id)
# –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ ORM
example_10 = select(Category).join(Category.products)


# –ú–µ—Ç–æ–¥ limit() - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ LIMIT –≤ SQL.
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ limit() –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
example_11 = select(Category).limit(5)


# –ú–µ—Ç–æ–¥ offset() - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ OFFSET –≤ SQL.
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–µ —Å limit() –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–µ 10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –≤–∑—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ 5
example_12 = select(Category).offset(10).limit(5)

print("-" * 135)
# 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞

with SessionLocal() as session:
    # –ú–µ—Ç–æ–¥ execute() –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç Result, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
    example_13 = select(Category).where(Category.is_active)
    console.print(f"[red]{type(example_13)}[/red]")
    result_13_1 = session.execute(example_13)
    console.print(f"[red]{type(result_13_1)}[/red]")
    # –í—ã–∑—ã–≤–∞–π—Ç–µ execute() –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ scalars(), —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã Row

    print("-" * 135)

    # –ú–µ—Ç–æ–¥ scalars() - –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –∏–∑ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –≤–æ–∑–≤—Ä–∞—â–∞—è –æ–±—ä–µ–∫—Ç—ã ScalarResult. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ORM-–æ–±—ä–µ–∫—Ç–æ–≤.
    result_13_2 = session.execute(example_13).scalars()
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ scalars() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ ORM-–æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ —Å–∫–∞–ª—è—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, id –∏–ª–∏ name).
    console.print(f"[red]{type(result_13_2)}[/red]")

    # –ú–µ—Ç–æ–¥ all() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞.
    result_13_3 = session.execute(stmt).scalars().all()

    # –ú–µ—Ç–æ–¥ first() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ None, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–π
    result_13_4 = session.execute(stmt).scalars().first()
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ first() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é.

    # –ú–µ—Ç–æ–¥ scalar() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ None, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–π
    result_13_5 = session.execute(select(func.count(Category.id))).scalar()
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 10 (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
print("-" * 135)
with SessionLocal() as session:
    # 1. –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π?
    total = session.scalar(select(func.count()).select_from(Category))
    print(f"\nüìä –í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {total}")

    # 2. –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    all_categories = session.scalars(select(Category)).all()
    print("\nüìã –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:")
    for cat in all_categories:
        print(f"  - {cat.name}: is_active={cat.is_active}")

    # 3. –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
    active = session.scalars(select(Category).where(Category.is_active)).all()
    print(f"\n‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {len(active)}")

    # 4. –¢–æ–ª—å–∫–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
    inactive = session.scalars(select(Category).where(Category.is_active)).all()
    print(f"\n‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {len(inactive)}")
